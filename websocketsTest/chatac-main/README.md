# Chatac
***
A simple chat system using:
* a backend based on aiohttp (Python) implementing websockets
* a (ugly) frontend based on React

This is a demonstration app whose purpose is to create chat sessions between several (2 or more) people waiting in a queue.
It can be adapted for more complex situations.

## Executing Chatac

To run Chatac, you must start the Python backend and then the React frontend.
We assume that Python 3 and NodeJS are already installed on your system.
If this is not the case, please visit the [Python](https://www.python.org/downloads/) and [NodeJS](https://nodejs.org/en/download/) sites for further information.

### Starting the Python backend

With a terminal, enter the `backend` directory:
> cd backend

Then create a new virtual environment in the `venv` directory for the server (to avoid disturbing your global Python install):
> python -m venv venv 

Activate the virtual environement in your shell:
> source venv/bin/activate

This previous command works in Linux with a bash shell; if you use another OS and/or shell, you will find the appropriate commands [here](https://docs.python.org/3/library/venv.html#how-venvs-work).

You are ready to install in this virtual environment the chatac server.
This command will install the chatac server in an editable mode (we continue to assume that you are in the `backend` directory):
> pip install --editable .

This means that you can edit directly the source code in the `src` directory without having to reinstall chatac.
For a standard install, remove the `--editable` option. If you edit the source, you will have to install again with the same command.

The script must be started with the command (assuming you want to start the server on localhost:8090):
> chatac-server -i localhost -p 8090

One can append to the previous command the options `-H mymodule.HooksClass` and `-P path/to/hooks/params.yml` to specify a custom ChatHooks class and the parameters used to configure it (with a YAML file).
You can read the `src/chatac/hooks.py` file to understand how ChatHooks works.
With hooks, you can configure the waiting rooms of the server, the number of attendees in a chat session, the duration of a chat session, the welcome and exit message of a chat session...

If you edit the source to make modifications (in editable mode install), don't forget to restart the backend.

### Starting the React frontend

If you want to start the React frontend in debug mode, go the frontend directory:
> cd frontend

And then start the debug server with this command:
> npm run start

The backend must be started before. By default the frontend assumes that the backend is reachable at `ws://localhost:8090/chat`.
If the backend runs on another port and/or machine, create a `.env.local` file at the root of the `frontend` directory and add the following line (if your backend is hosted at `wss://backend.example.com/chat`):
> REACT_APP_BACKEND_URL=wss://backend.example.com/chat

Note that the frontend is far from gorgeous: its only purpose is to test the backend.

## Deploying chatac with Docker

You can deploy a complete chatac install in docker containers using the `docker-compose.yml` file.
Two containers will be created:
1. A container with the Python backend
2. A container with Nginx:
   - hosting the static HTML/CSS/JS files generated by React for the frontend
   - including a reverse proxy rule to access the Python backend

Build and run the containers with this command (at the root directory of the project):
> docker-compose up

By default, the nginx server is reachable at port `8080` (environment variable NGINX_PORT).

For a customized experience (especially to provide custom hooks), you can copy the `.env` file and edit it.
Then add your new env file to the `docker-compose` command:
> docker-compose --env-file my-custom-env

You can also add environment variable with the `-e KEY=VALUE` option.

Supported environment variables are:
- `NGINX_PORT` to specify on which port Nginx is exposed
- `SERVER_LOG_LEVEL` to set the severity for logging (verbose, debug, info, error)
- `SERVER_HOOKS` to set the path the the Python class managing the hooks
- `SERVER_HOOKS_PARAMS` to specify the path to the file containing params (if required) for the server hooks


## License

This application is released under the [Apache 2.0 License](https://www.apache.org/licenses/LICENSE-2.0).
Please let the name of the author in the documentation of your software if it uses some parts of chatac.
Do not hesitate to send a nice email to the author ;) It will be appreciated.

> Copyright 2023 Michel Chilowicz
>
>   Licensed under the Apache License, Version 2.0 (the "License");
>   you may not use this file except in compliance with the License.
>   You may obtain a copy of the License at
>
>       http://www.apache.org/licenses/LICENSE-2.0
>
>   Unless required by applicable law or agreed to in writing, software
>   distributed under the License is distributed on an "AS IS" BASIS,
>   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
>   See the License for the specific language governing permissions and
>   limitations under the License.
